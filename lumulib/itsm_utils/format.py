import re
from typing import MutableMapping


def camel_case(s):
    """

    :param s: camel case other
    :return:  camelCaseOther
    """
    return re.sub(r"\s([A-Za-z0-9])?", lambda m: m.group(0).strip().upper(), s)


def flatten_dict(
    d: MutableMapping, parent_key: str = "", sep: str = "."
) -> MutableMapping:
    """

    :param d:
    {'companyId': '10228d9c-ff18-4251-ac19-514185e00f17', 'comment': '', 'incidentId': 'fc1a67a0-afbe-11ee-9146-116839cf7e3a', 'url': 'https://portal.lumu.io/compromise/incidents/show/fc1a67a0-afbe-11ee-9146-116839cf7e3a/detections', 'incident': {'id': 'fc1a67a0-afbe-11ee-9146-116839cf7e3a', 'timestamp': '2024-01-10T13:48:50.330Z', 'statusTimestamp': '2024-01-10T13:48:50.330Z', 'status': 'open', 'contacts': 319, 'adversaries': ['hockeysmall.com'], 'adversaryId': 'hockeysmall.com', 'adversaryTypes': ['C2C', 'Malware'], 'description': 'CobaltStrike', 'labelDistribution': {'client test': 280, 'Unlabeled activity': 39}, 'totalEndpoints': 183, 'lastContact': '2024-04-18T14:11:50.225Z', 'unread': False, 'hasPlaybackContacts': False, 'firstContact': '2024-01-10T13:48:39.391Z', 'integrationsThatResponded': ['4e06e8a5-d20e-4537-8f4e-cab408d3e8fa', '8323f257-8237-43f6-a7a3-3ec9f948869c', 'b84c32dc-4d2d-4dba-9c29-e483f68ab7e5', 'a2d335ed-54ae-4565-ac3b-9e41daea8e3a', 'd167a953-9e3a-42d2-80b6-7546ff6d1df0', '31fb5edd-6bb6-4330-a44c-0337e77c0672', '4115e79a-cc4e-420b-ad68-11d7d0e19a0d', '161b0038-bb09-4446-879d-ab317ec38fc6', 'ff4d0db4-6174-43ec-88a8-b60c3184c4e4', 'a7a661a1-4b11-42df-bdf2-1286f400137a', '3713a2a6-357b-4002-be79-7f138c68fe02', '8042e6bb-f85a-4cb3-9903-211443f508c9', '5a6a376c-4ba6-4a00-ab98-10d66ccc825e', 'b2f94a3a-6e2f-487d-b73d-50723375b64d', '7ebf8d0b-8c42-436b-a5a6-1dcd136f1611', '30d881d2-6333-4978-9c71-9678d339afca', 'b2c9d6b9-df6d-4538-9725-b252117a5f1a', '47875716-0c5e-421e-900c-27a172b018b6', '49abcaca-1b5a-4c3e-aa61-c4d32d079b88', '54fb66f3-8c2a-4c11-a7d9-96218d9b1b50', 'd5103e62-34ea-4ff4-95db-5c6c76771e7f', '8a25fa44-ade1-423d-a414-2b19da6cc8aa', '3c1a60c5-aae6-431e-883c-b49c0994db3d', '4ed0c263-b32d-4a9d-9ab6-b2c409161943']}, 'endpoints': ['192.168.10.93', '192.168.10.201', '192.168.10.231', '192.168.10.211', '192.168.10.118', '192.168.10.123', '192.168.10.112', '192.168.10.233', '192.168.10.5', '192.168.10.180', '192.168.10.107', '192.168.10.187', '192.168.10.37', '192.168.10.40', '192.168.10.189', '192.168.10.157', '192.168.10.32', '192.168.10.12', '192.168.10.250', '192.168.10.23', '192.168.10.2', '192.168.10.87', '192.168.10.251', '192.168.10.94', '192.168.10.181', '192.168.10.26', '192.168.10.165', '192.168.10.33', '192.168.10.8', '192.168.10.188', '192.168.10.69', '192.168.10.13', '192.168.10.143', '192.168.10.200', '192.168.10.29', '192.168.10.195', '192.168.10.7', '192.168.10.11', '192.168.10.237', '192.168.10.110', '192.168.10.24', '192.168.10.163', '192.168.10.56', '192.168.10.228', '192.168.10.52', '192.168.10.67', '192.168.10.25', '192.168.10.150', '192.168.10.64', '192.168.10.92', '192.168.10.105', '192.168.10.27', '192.168.10.230', '192.168.10.155', '192.168.10.88', '192.168.10.183', '192.168.10.108', '192.168.10.216', '192.168.10.247', '192.168.10.1', '192.168.10.102', '192.168.10.244', '192.168.10.209', '192.168.10.171', '192.168.10.68', '192.168.10.72', '192.168.10.229', '192.168.10.61', '192.168.10.160', '192.168.10.20', '192.168.10.119', '192.168.10.99', '192.168.10.184', '192.168.10.199', '192.168.10.203', '192.168.10.253', '192.168.10.122', '192.168.10.144', '192.168.10.168', '192.168.10.44', '192.168.10.15', '192.168.10.103', '192.168.10.220', '192.168.10.213', '192.168.10.39', '192.168.10.173', '192.168.10.84', '192.168.10.139', '192.168.10.115', '192.168.10.100', '192.168.10.60', '192.168.10.242', '192.168.10.207', '192.168.10.42', '192.168.10.109', '192.168.10.154', '192.168.10.145', '192.168.10.30', '192.168.10.134', '192.168.10.215', '192.168.10.55', '192.168.10.106', '192.168.10.182', '192.168.10.76', '192.168.10.95', '192.168.10.65', '192.168.10.245', '192.168.10.49', '192.168.10.185', '192.168.10.79', '192.168.10.28', '192.168.10.151', '192.168.10.224', '192.168.10.248', '192.168.10.147', '192.168.10.10', '192.168.10.80', '192.168.10.46', '192.168.10.135', '192.168.10.90', '192.168.10.179', '192.168.10.70', '192.168.10.101', '192.168.10.104', '192.168.10.159', '192.168.10.194', '192.168.10.235', '192.168.10.153', '192.168.10.204', '192.168.10.59', '192.168.10.48', '192.168.10.167', '192.168.10.19', '192.168.10.197', '192.168.10.22', '192.168.10.89', '192.168.10.142', '192.168.10.223', '192.168.10.156', '192.168.10.114', '192.168.10.205', '192.168.10.249', '192.168.10.127', '192.168.10.83', '192.168.10.71', '192.168.10.47', '192.168.10.120', '192.168.10.31', '192.168.10.96', '192.168.10.140', '192.168.10.241', '192.168.10.66', '192.168.10.178', '192.168.10.136', '192.168.10.246', '192.168.10.161', '192.168.10.116', '192.168.10.192', '192.168.10.162', '192.168.10.240', '192.168.10.232', '192.168.10.221', '192.168.10.202', '192.168.10.239', '192.168.10.35', '192.168.10.4', '192.168.10.191', '192.168.10.98', '192.168.10.218', '192.168.10.85', '192.168.10.193', '192.168.10.97', '192.168.10.74', '192.168.10.34', '192.168.10.36', '192.168.10.50', '192.168.10.236', '192.168.10.164', '192.168.10.75', '192.168.10.176', '192.168.10.166', '192.168.10.58'], 'labels': ['client test', 'Unlabeled activity']}
    :param parent_key:
    :param sep:
    :return:
    {'companyId': '10228d9c-ff18-4251-ac19-514185e00f17', 'comment': '', 'incidentId': 'fc1a67a0-afbe-11ee-9146-116839cf7e3a', 'url': 'https://portal.lumu.io/compromise/incidents/show/fc1a67a0-afbe-11ee-9146-116839cf7e3a/detections', 'incident.id': 'fc1a67a0-afbe-11ee-9146-116839cf7e3a', 'incident.timestamp': '2024-01-10T13:48:50.330Z', 'incident.statusTimestamp': '2024-01-10T13:48:50.330Z', 'incident.status': 'open', 'incident.contacts': 319, 'incident.adversaries.0': 'hockeysmall.com', 'incident.adversaryId': 'hockeysmall.com', 'incident.adversaryTypes.0': 'C2C', 'incident.adversaryTypes.1': 'Malware', 'incident.description': 'CobaltStrike', 'incident.labelDistribution.clientTest': 280, 'incident.labelDistribution.UnlabeledActivity': 39, 'incident.totalEndpoints': 183, 'incident.lastContact': '2024-04-18T14:11:50.225Z', 'incident.unread': False, 'incident.hasPlaybackContacts': False, 'incident.firstContact': '2024-01-10T13:48:39.391Z', 'incident.integrationsThatResponded.0': '4e06e8a5-d20e-4537-8f4e-cab408d3e8fa', 'incident.integrationsThatResponded.1': '8323f257-8237-43f6-a7a3-3ec9f948869c', 'incident.integrationsThatResponded.2': 'b84c32dc-4d2d-4dba-9c29-e483f68ab7e5', 'incident.integrationsThatResponded.3': 'a2d335ed-54ae-4565-ac3b-9e41daea8e3a', 'incident.integrationsThatResponded.4': 'd167a953-9e3a-42d2-80b6-7546ff6d1df0', 'incident.integrationsThatResponded.5': '31fb5edd-6bb6-4330-a44c-0337e77c0672', 'incident.integrationsThatResponded.6': '4115e79a-cc4e-420b-ad68-11d7d0e19a0d', 'incident.integrationsThatResponded.7': '161b0038-bb09-4446-879d-ab317ec38fc6', 'incident.integrationsThatResponded.8': 'ff4d0db4-6174-43ec-88a8-b60c3184c4e4', 'incident.integrationsThatResponded.9': 'a7a661a1-4b11-42df-bdf2-1286f400137a', 'incident.integrationsThatResponded.10': '3713a2a6-357b-4002-be79-7f138c68fe02', 'incident.integrationsThatResponded.11': '8042e6bb-f85a-4cb3-9903-211443f508c9', 'incident.integrationsThatResponded.12': '5a6a376c-4ba6-4a00-ab98-10d66ccc825e', 'incident.integrationsThatResponded.13': 'b2f94a3a-6e2f-487d-b73d-50723375b64d', 'incident.integrationsThatResponded.14': '7ebf8d0b-8c42-436b-a5a6-1dcd136f1611', 'incident.integrationsThatResponded.15': '30d881d2-6333-4978-9c71-9678d339afca', 'incident.integrationsThatResponded.16': 'b2c9d6b9-df6d-4538-9725-b252117a5f1a', 'incident.integrationsThatResponded.17': '47875716-0c5e-421e-900c-27a172b018b6', 'incident.integrationsThatResponded.18': '49abcaca-1b5a-4c3e-aa61-c4d32d079b88', 'incident.integrationsThatResponded.19': '54fb66f3-8c2a-4c11-a7d9-96218d9b1b50', 'incident.integrationsThatResponded.20': 'd5103e62-34ea-4ff4-95db-5c6c76771e7f', 'incident.integrationsThatResponded.21': '8a25fa44-ade1-423d-a414-2b19da6cc8aa', 'incident.integrationsThatResponded.22': '3c1a60c5-aae6-431e-883c-b49c0994db3d', 'incident.integrationsThatResponded.23': '4ed0c263-b32d-4a9d-9ab6-b2c409161943', 'endpoints.0': '192.168.10.93', 'endpoints.1': '192.168.10.201', 'endpoints.2': '192.168.10.231', 'endpoints.3': '192.168.10.211', 'endpoints.4': '192.168.10.118', 'endpoints.5': '192.168.10.123', 'endpoints.6': '192.168.10.112', 'endpoints.7': '192.168.10.233', 'endpoints.8': '192.168.10.5', 'endpoints.9': '192.168.10.180', 'endpoints.10': '192.168.10.107', 'endpoints.11': '192.168.10.187', 'endpoints.12': '192.168.10.37', 'endpoints.13': '192.168.10.40', 'endpoints.14': '192.168.10.189', 'endpoints.15': '192.168.10.157', 'endpoints.16': '192.168.10.32', 'endpoints.17': '192.168.10.12', 'endpoints.18': '192.168.10.250', 'endpoints.19': '192.168.10.23', 'endpoints.20': '192.168.10.2', 'endpoints.21': '192.168.10.87', 'endpoints.22': '192.168.10.251', 'endpoints.23': '192.168.10.94', 'endpoints.24': '192.168.10.181', 'endpoints.25': '192.168.10.26', 'endpoints.26': '192.168.10.165', 'endpoints.27': '192.168.10.33', 'endpoints.28': '192.168.10.8', 'endpoints.29': '192.168.10.188', 'endpoints.30': '192.168.10.69', 'endpoints.31': '192.168.10.13', 'endpoints.32': '192.168.10.143', 'endpoints.33': '192.168.10.200', 'endpoints.34': '192.168.10.29', 'endpoints.35': '192.168.10.195', 'endpoints.36': '192.168.10.7', 'endpoints.37': '192.168.10.11', 'endpoints.38': '192.168.10.237', 'endpoints.39': '192.168.10.110', 'endpoints.40': '192.168.10.24', 'endpoints.41': '192.168.10.163', 'endpoints.42': '192.168.10.56', 'endpoints.43': '192.168.10.228', 'endpoints.44': '192.168.10.52', 'endpoints.45': '192.168.10.67', 'endpoints.46': '192.168.10.25', 'endpoints.47': '192.168.10.150', 'endpoints.48': '192.168.10.64', 'endpoints.49': '192.168.10.92', 'endpoints.50': '192.168.10.105', 'endpoints.51': '192.168.10.27', 'endpoints.52': '192.168.10.230', 'endpoints.53': '192.168.10.155', 'endpoints.54': '192.168.10.88', 'endpoints.55': '192.168.10.183', 'endpoints.56': '192.168.10.108', 'endpoints.57': '192.168.10.216', 'endpoints.58': '192.168.10.247', 'endpoints.59': '192.168.10.1', 'endpoints.60': '192.168.10.102', 'endpoints.61': '192.168.10.244', 'endpoints.62': '192.168.10.209', 'endpoints.63': '192.168.10.171', 'endpoints.64': '192.168.10.68', 'endpoints.65': '192.168.10.72', 'endpoints.66': '192.168.10.229', 'endpoints.67': '192.168.10.61', 'endpoints.68': '192.168.10.160', 'endpoints.69': '192.168.10.20', 'endpoints.70': '192.168.10.119', 'endpoints.71': '192.168.10.99', 'endpoints.72': '192.168.10.184', 'endpoints.73': '192.168.10.199', 'endpoints.74': '192.168.10.203', 'endpoints.75': '192.168.10.253', 'endpoints.76': '192.168.10.122', 'endpoints.77': '192.168.10.144', 'endpoints.78': '192.168.10.168', 'endpoints.79': '192.168.10.44', 'endpoints.80': '192.168.10.15', 'endpoints.81': '192.168.10.103', 'endpoints.82': '192.168.10.220', 'endpoints.83': '192.168.10.213', 'endpoints.84': '192.168.10.39', 'endpoints.85': '192.168.10.173', 'endpoints.86': '192.168.10.84', 'endpoints.87': '192.168.10.139', 'endpoints.88': '192.168.10.115', 'endpoints.89': '192.168.10.100', 'endpoints.90': '192.168.10.60', 'endpoints.91': '192.168.10.242', 'endpoints.92': '192.168.10.207', 'endpoints.93': '192.168.10.42', 'endpoints.94': '192.168.10.109', 'endpoints.95': '192.168.10.154', 'endpoints.96': '192.168.10.145', 'endpoints.97': '192.168.10.30', 'endpoints.98': '192.168.10.134', 'endpoints.99': '192.168.10.215', 'endpoints.100': '192.168.10.55', 'endpoints.101': '192.168.10.106', 'endpoints.102': '192.168.10.182', 'endpoints.103': '192.168.10.76', 'endpoints.104': '192.168.10.95', 'endpoints.105': '192.168.10.65', 'endpoints.106': '192.168.10.245', 'endpoints.107': '192.168.10.49', 'endpoints.108': '192.168.10.185', 'endpoints.109': '192.168.10.79', 'endpoints.110': '192.168.10.28', 'endpoints.111': '192.168.10.151', 'endpoints.112': '192.168.10.224', 'endpoints.113': '192.168.10.248', 'endpoints.114': '192.168.10.147', 'endpoints.115': '192.168.10.10', 'endpoints.116': '192.168.10.80', 'endpoints.117': '192.168.10.46', 'endpoints.118': '192.168.10.135', 'endpoints.119': '192.168.10.90', 'endpoints.120': '192.168.10.179', 'endpoints.121': '192.168.10.70', 'endpoints.122': '192.168.10.101', 'endpoints.123': '192.168.10.104', 'endpoints.124': '192.168.10.159', 'endpoints.125': '192.168.10.194', 'endpoints.126': '192.168.10.235', 'endpoints.127': '192.168.10.153', 'endpoints.128': '192.168.10.204', 'endpoints.129': '192.168.10.59', 'endpoints.130': '192.168.10.48', 'endpoints.131': '192.168.10.167', 'endpoints.132': '192.168.10.19', 'endpoints.133': '192.168.10.197', 'endpoints.134': '192.168.10.22', 'endpoints.135': '192.168.10.89', 'endpoints.136': '192.168.10.142', 'endpoints.137': '192.168.10.223', 'endpoints.138': '192.168.10.156', 'endpoints.139': '192.168.10.114', 'endpoints.140': '192.168.10.205', 'endpoints.141': '192.168.10.249', 'endpoints.142': '192.168.10.127', 'endpoints.143': '192.168.10.83', 'endpoints.144': '192.168.10.71', 'endpoints.145': '192.168.10.47', 'endpoints.146': '192.168.10.120', 'endpoints.147': '192.168.10.31', 'endpoints.148': '192.168.10.96', 'endpoints.149': '192.168.10.140', 'endpoints.150': '192.168.10.241', 'endpoints.151': '192.168.10.66', 'endpoints.152': '192.168.10.178', 'endpoints.153': '192.168.10.136', 'endpoints.154': '192.168.10.246', 'endpoints.155': '192.168.10.161', 'endpoints.156': '192.168.10.116', 'endpoints.157': '192.168.10.192', 'endpoints.158': '192.168.10.162', 'endpoints.159': '192.168.10.240', 'endpoints.160': '192.168.10.232', 'endpoints.161': '192.168.10.221', 'endpoints.162': '192.168.10.202', 'endpoints.163': '192.168.10.239', 'endpoints.164': '192.168.10.35', 'endpoints.165': '192.168.10.4', 'endpoints.166': '192.168.10.191', 'endpoints.167': '192.168.10.98', 'endpoints.168': '192.168.10.218', 'endpoints.169': '192.168.10.85', 'endpoints.170': '192.168.10.193', 'endpoints.171': '192.168.10.97', 'endpoints.172': '192.168.10.74', 'endpoints.173': '192.168.10.34', 'endpoints.174': '192.168.10.36', 'endpoints.175': '192.168.10.50', 'endpoints.176': '192.168.10.236', 'endpoints.177': '192.168.10.164', 'endpoints.178': '192.168.10.75', 'endpoints.179': '192.168.10.176', 'endpoints.180': '192.168.10.166', 'endpoints.181': '192.168.10.58', 'labels.0': 'client test', 'labels.1': 'Unlabeled activity'}
    """
    items = []
    for k, v in d.items():
        new_key = parent_key + sep + camel_case(k) if parent_key else k
        if isinstance(v, MutableMapping):
            items.extend(flatten_dict(v, new_key, sep=sep).items())
        elif isinstance(v, list):
            n_v = dict([(str(nk), nv) for nk, nv in enumerate(v)])
            items.extend(flatten_dict(n_v, new_key, sep=sep).items())
        else:
            items.append((new_key, v))
    return dict(items)
